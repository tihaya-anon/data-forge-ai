# ===========================================
# DataForge AI - Analytics Services
# ===========================================
# Apache Doris (OLAP)

services:
  # -------------------------------------------
  # Doris Frontend
  # -------------------------------------------
  doris-fe:
    image: apache/doris:2.0.3-fe-x86_64
    container_name: dataforge-doris-fe
    ports:
      - "8030:8030"
      - "9030:9030"
    environment:
      TZ: Asia/Shanghai
      FE_SERVERS: fe1:doris-fe:9010
      FE_ID: 1
    volumes:
      - doris-fe-data:/opt/apache-doris/fe/doris-meta
    networks:
      - dataforge
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8030/api/bootstrap"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped

  # -------------------------------------------
  # Doris Backend
  # -------------------------------------------
  doris-be:
    image: apache/doris:2.0.3-be-x86_64
    container_name: dataforge-doris-be
    environment:
      TZ: Asia/Shanghai
      FE_SERVERS: fe1:doris-fe:9010
      BE_ADDR: doris-be:9050
    volumes:
      - doris-be-data:/opt/apache-doris/be/storage
    networks:
      - dataforge
    depends_on:
      doris-fe:
        condition: service_healthy
    restart: unless-stopped

networks:
  dataforge:
    external: true

volumes:
  doris-fe-data:
    external: true
  doris-be-data:
    external: true
