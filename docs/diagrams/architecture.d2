# DataForge AI - 系统架构全景图
# Author: DataForge Team
# Description: 展示整个平台的分层架构（正方形布局）

grid-columns: 2

title: {
  label: DataForge AI - System Architecture
  near: top-center
  shape: text
  style: {
    font-size: 28
    bold: true
    font-color: "#1a237e"
  }
}

# ==========================================
# 左上：数据源
# ==========================================
sources: Data Sources {
  style: {
    fill: "#e3f2fd"
    stroke: "#1565c0"
    border-radius: 8
  }
  
  grid-columns: 3
  grid-gap: 0
  
  crawl: Common Crawl {
    shape: document
    style.fill: "#bbdefb"
  }
  wiki: Wikipedia {
    shape: document
    style.fill: "#bbdefb"
  }
  github: GitHub Code {
    shape: document
    style.fill: "#bbdefb"
  }
  docs: Enterprise Docs {
    shape: document
    style.fill: "#bbdefb"
  }
  mysql: MySQL/PG {
    shape: cylinder
    style.fill: "#90caf9"
  }
  api: External APIs {
    shape: cloud
    style.fill: "#64b5f6"
  }
}

# ==========================================
# 右上：采集层
# ==========================================
ingestion: Data Ingestion {
  style: {
    fill: "#fff8e1"
    stroke: "#f9a825"
    border-radius: 8
  }
  
  grid-columns: 3
  grid-gap: 0
  
  debezium: Debezium CDC {
    style.fill: "#fff59d"
  }
  file-src: File Source {
    style.fill: "#fff59d"
  }
  http-src: HTTP Source {
    style.fill: "#fff59d"
  }
  
  kafka: Apache Kafka {
    shape: queue
    style: {
      fill: "#ffca28"
      stroke: "#f57f17"
      font-color: "#000"
      bold: true
    }
    width: 400
  }
  
  debezium -> kafka
  file-src -> kafka
  http-src -> kafka
}

# ==========================================
# 左中：计算层
# ==========================================
compute: Compute Layer {
  style: {
    fill: "#fce4ec"
    stroke: "#c2185b"
    border-radius: 8
  }
  
  grid-columns: 3
  grid-gap: 0
  
  spark: Spark {
    shape: hexagon
    style: {
      fill: "#e65100"
      font-color: "#fff"
      bold: true
    }
    label: "Spark\nBatch"
  }
  
  flink: Flink {
    shape: hexagon
    style: {
      fill: "#d81b60"
      font-color: "#fff"
      bold: true
    }
    label: "Flink\nStream"
  }
  
  ray: Ray {
    shape: hexagon
    style: {
      fill: "#7b1fa2"
      font-color: "#fff"
      bold: true
    }
    label: "Ray\nML"
  }
}

# ==========================================
# 右中：存储层
# ==========================================
storage: Storage Layer {
  style: {
    fill: "#e8f5e9"
    stroke: "#2e7d32"
    border-radius: 8
  }
  
  grid-columns: 2
  grid-gap: 0
  
  paimon: Paimon {
    shape: cylinder
    style: {
      fill: "#43a047"
      font-color: "#fff"
      bold: true
    }
    label: "Paimon\nData Lake"
  }
  
  milvus: Milvus {
    shape: cylinder
    style: {
      fill: "#00acc1"
      font-color: "#fff"
      bold: true
    }
    label: "Milvus\nVector DB"
  }
  
  redis: Redis {
    shape: cylinder
    style: {
      fill: "#d32f2f"
      font-color: "#fff"
      bold: true
    }
    label: "Redis\nCache"
  }
  
  es: ES {
    shape: cylinder
    style: {
      fill: "#fdd835"
      font-color: "#000"
      bold: true
    }
    label: "ES\nFull-text"
  }
}

# ==========================================
# 左下：服务层
# ==========================================
services: Service Layer {
  style: {
    fill: "#ede7f6"
    stroke: "#512da8"
    border-radius: 8
  }
  
  grid-columns: 3
  grid-gap: 0
  
  rag-svc: RAG Service {
    style: {
      fill: "#7c4dff"
      font-color: "#fff"
      bold: true
    }
  }
  
  data-svc: Data Service {
    style: {
      fill: "#651fff"
      font-color: "#fff"
      bold: true
    }
  }
  
  doris: Doris (OLAP) {
    shape: cylinder
    style: {
      fill: "#304ffe"
      font-color: "#fff"
      bold: true
    }
  }
}

# ==========================================
# 右下：应用 + 编排
# ==========================================
apps-orch: Applications & Orchestration {
  style: {
    fill: "#efebe9"
    stroke: "#5d4037"
    border-radius: 8
  }
  
  grid-columns: 3
  grid-gap: 0
  
  llm-train: LLM Training {
    style.fill: "#bcaaa4"
  }
  rag-chat: RAG Chat {
    style.fill: "#bcaaa4"
  }
  dashboard: Dashboard {
    style.fill: "#bcaaa4"
  }
  airflow: Airflow {
    style.fill: "#00bfa5"
    style.font-color: "#fff"
  }
  datahub: DataHub {
    style.fill: "#26a69a"
    style.font-color: "#fff"
  }
  prometheus: Prometheus {
    style.fill: "#e64a19"
    style.font-color: "#fff"
  }
}

# ==========================================
# 连接关系
# ==========================================
sources -> ingestion: Ingest {
  style.stroke: "#1565c0"
  style.stroke-width: 2
}

ingestion -> compute: Process {
  style.stroke: "#f9a825"
  style.stroke-width: 2
}

compute -> storage: Store {
  style.stroke: "#c2185b"
  style.stroke-width: 2
}

storage -> services: Serve {
  style.stroke: "#2e7d32"
  style.stroke-width: 2
}

services -> apps-orch: Use {
  style.stroke: "#512da8"
  style.stroke-width: 2
}

apps-orch -> compute: Schedule {
  style.stroke: "#455a64"
  style.stroke-dash: 5
}
