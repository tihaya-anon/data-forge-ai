# DataForge AI - 系统架构全景图
# 展示整个平台的分层架构

grid-columns: 2
grid-gap: 20

classes: {
  layer: {
    style: {
      fill: "#f5f5f5"
      stroke: "#78909c"
      border-radius: 8
    }
  }
}

title: {
  label: DataForge AI - 系统架构
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
    font-color: "#37474f"
  }
}

sources: "数据源" {
  class: layer
  grid-columns: 3
  grid-gap: 10

  crawl: "Common Crawl" {
    shape: document
    style.fill: "#e8eaf6"
  }
  wiki: "Wikipedia" {
    shape: document
    style.fill: "#e8eaf6"
  }
  github: "GitHub Code" {
    shape: document
    style.fill: "#e8eaf6"
  }
  docs: "企业文档" {
    shape: document
    style.fill: "#e8eaf6"
  }
  mysql: "MySQL/PG" {
    shape: cylinder
    style.fill: "#e8eaf6"
  }
  api: "外部 APIs" {
    shape: cloud
    style.fill: "#e8eaf6"
  }
}

ingestion: "数据采集" {
  class: layer
  grid-columns: 4
  grid-gap: 10

  debezium: "Debezium CDC"
  file-src: "File Source"
  http-src: "HTTP Source"

  kafka: "Apache Kafka" {
    shape: queue
    style: {
      fill: "#9fa8da"
      stroke: "#7986cb"
      font-color: "#fff"
      bold: true
    }
  }
}

compute: "计算层" {
  class: layer
  grid-columns: 3
  grid-gap: 10

  spark: "Spark\n批处理" {
    shape: hexagon
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }

  flink: "Flink\n流处理" {
    shape: hexagon
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }

  ray: "Ray\nML" {
    shape: hexagon
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }
}

storage: "存储层" {
  class: layer
  grid-columns: 2
  grid-gap: 10

  paimon: "Paimon\n数据湖" {
    shape: cylinder
    style: {
      fill: "#c5cae9"
      font-color: "#000"
      bold: true
    }
  }

  milvus: "Milvus\n向量库" {
    shape: cylinder
    style: {
      fill: "#c5cae9"
      font-color: "#000"
      bold: true
    }
  }

  redis: "Redis\n缓存" {
    shape: cylinder
    style: {
      fill: "#c5cae9"
      font-color: "#000"
      bold: true
    }
  }

  es: "ES\n全文检索" {
    shape: cylinder
    style: {
      fill: "#c5cae9"
      font-color: "#000"
      bold: true
    }
  }
}

services: "服务层" {
  class: layer
  grid-columns: 3
  grid-gap: 10

  rag-svc: "RAG Service" {
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }

  data-svc: "Data Service" {
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }

  doris: "Doris (OLAP)" {
    shape: cylinder
    style: {
      fill: "#9fa8da"
      font-color: "#fff"
      bold: true
    }
  }
}

apps-orch: "应用与编排" {
  class: layer
  grid-columns: 3
  grid-gap: 10

  llm-train: "LLM Training"
  rag-chat: "RAG Chat"
  dashboard: "Dashboard"
  airflow: "Airflow" {
    style.fill: "#e8eaf6"
  }
  datahub: "DataHub" {
    style.fill: "#e8eaf6"
  }
  prometheus: "Prometheus" {
    style.fill: "#e8eaf6"
  }
}

sources -> ingestion: 采集 {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

ingestion.debezium -> ingestion.kafka
ingestion.file-src -> ingestion.kafka
ingestion.http-src -> ingestion.kafka

ingestion -> compute: 处理 {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

compute -> storage: 存储 {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

storage -> services: 服务 {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

services -> apps-orch: 使用 {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

apps-orch -> compute: 调度 {
  style: {
    stroke: "#78909c"
    stroke-dash: 5
  }
}
