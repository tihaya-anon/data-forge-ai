# Êï∞ÊçÆÊµÅËΩ¨ÂÖ®ÊôØÂõæ
# Â±ïÁ§∫ÂÆûÊó∂ÊµÅÂíåÊâπÂ§ÑÁêÜÊµÅÁöÑÊï∞ÊçÆÊµÅËΩ¨

direction: right

title: {
  label: Data Flow Overview
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
    font-color: "#1565c0"
  }
}

# ==========================================
# Êï∞ÊçÆÊ∫ê
# ==========================================
sources: "üì• Data Sources" {
  style: {
    fill: "#e3f2fd"
    stroke: "#1565c0"
    border-radius: 8
  }
  
  direction: down
  
  db: "Databases\nMySQL/PG/Mongo" {
    shape: cylinder
    style.fill: "#90caf9"
  }
  
  files: "Files\nS3/HDFS/NAS" {
    shape: document
    style.fill: "#64b5f6"
  }
  
  api: "APIs\nREST/GraphQL" {
    shape: cloud
    style.fill: "#42a5f5"
  }
}

# ==========================================
# Kafka
# ==========================================
kafka: "Apache Kafka" {
  shape: queue
  style: {
    fill: "#ffca28"
    stroke: "#f57f17"
    bold: true
    font-size: 16
  }
}

# ==========================================
# ÂÆûÊó∂ÊµÅÂ§ÑÁêÜ
# ==========================================
realtime: "üî• Real-time Stream" {
  style: {
    fill: "#fce4ec"
    stroke: "#c2185b"
    border-radius: 8
  }
  
  flink: "Apache Flink" {
    style: {
      fill: "#e91e63"
      font-color: "#fff"
      bold: true
    }
  }
  
  ops: "Operations" {
    style.fill: "#f8bbd9"
    
    direction: down
    
    parse: "Parse & Clean"
    chunk: "Chunk"
    embed: "Embedding"
  }
  
  flink -> ops
  
  latency: {
    shape: text
    style: {
      font-size: 11
      italic: true
      font-color: "#880e4f"
    }
    label: "Latency: < 5s"
  }
}

# ==========================================
# ÊâπÂ§ÑÁêÜ
# ==========================================
batch: "‚ö° Batch Processing" {
  style: {
    fill: "#fff3e0"
    stroke: "#e65100"
    border-radius: 8
  }
  
  spark: "Apache Spark" {
    style: {
      fill: "#ff9800"
      font-color: "#fff"
      bold: true
    }
  }
  
  ops: "Operations" {
    style.fill: "#ffe0b2"
    
    direction: down
    
    clean: "Clean & Dedup"
    quality: "Quality Filter"
    embed: "Batch Embedding"
  }
  
  spark -> ops
  
  throughput: {
    shape: text
    style: {
      font-size: 11
      italic: true
      font-color: "#e65100"
    }
    label: "Throughput: 50TB/day"
  }
}

# ==========================================
# Êï∞ÊçÆÊπñ
# ==========================================
lake: "üè† Data Lake" {
  style: {
    fill: "#e8f5e9"
    stroke: "#2e7d32"
    border-radius: 8
  }
  
  paimon: "Apache Paimon" {
    shape: cylinder
    style: {
      fill: "#43a047"
      font-color: "#fff"
      bold: true
    }
  }
  
  tables: "Tables" {
    style.fill: "#a5d6a7"
    
    direction: down
    
    training: "training_data"
    knowledge: "knowledge_docs"
    metadata: "metadata"
  }
  
  features: {
    shape: text
    style: {
      font-size: 11
      font-color: "#2e7d32"
    }
    label: "‚Ä¢ Version control\n‚Ä¢ Time travel\n‚Ä¢ Incremental update"
  }
}

# ==========================================
# ÂêëÈáèÂ≠òÂÇ®
# ==========================================
vector: "üîç Vector Store" {
  style: {
    fill: "#e0f7fa"
    stroke: "#00838f"
    border-radius: 8
  }
  
  milvus: "Milvus" {
    shape: cylinder
    style: {
      fill: "#00acc1"
      font-color: "#fff"
      bold: true
    }
  }
  
  index: "HNSW Index" {
    style.fill: "#80deea"
    label: "HNSW Index\n100M+ vectors"
  }
  
  perf: {
    shape: text
    style: {
      font-size: 11
      font-color: "#006064"
    }
    label: "P99 < 50ms"
  }
}

# ==========================================
# Â∫îÁî®
# ==========================================
apps: "üéØ Applications" {
  style: {
    fill: "#ede7f6"
    stroke: "#512da8"
    border-radius: 8
  }
  
  direction: down
  
  rag: "RAG Service" {
    style: {
      fill: "#7c4dff"
      font-color: "#fff"
    }
  }
  
  train: "LLM Training" {
    style: {
      fill: "#651fff"
      font-color: "#fff"
    }
  }
  
  analytics: "Analytics" {
    style: {
      fill: "#536dfe"
      font-color: "#fff"
    }
  }
}

# ==========================================
# ËøûÊé• - ÂÆûÊó∂ÊµÅ
# ==========================================
sources.db -> kafka: CDC {
  style: {
    stroke: "#c2185b"
    stroke-width: 2
  }
}

kafka -> realtime: Consume {
  style: {
    stroke: "#c2185b"
    stroke-width: 2
  }
}

realtime -> vector: Vectors {
  style: {
    stroke: "#00838f"
    stroke-width: 2
  }
}

realtime -> lake: Metadata {
  style: {
    stroke: "#2e7d32"
    stroke-width: 2
  }
}

# ==========================================
# ËøûÊé• - ÊâπÂ§ÑÁêÜ
# ==========================================
sources.files -> batch: Load {
  style: {
    stroke: "#e65100"
    stroke-width: 2
    stroke-dash: 3
  }
}

kafka -> batch: Batch consume {
  style: {
    stroke: "#e65100"
    stroke-width: 2
    stroke-dash: 3
  }
}

batch -> lake: Write {
  style: {
    stroke: "#2e7d32"
    stroke-width: 2
    stroke-dash: 3
  }
}

batch -> vector: Bulk index {
  style: {
    stroke: "#00838f"
    stroke-width: 2
    stroke-dash: 3
  }
}

# ==========================================
# ËøûÊé• - Â∫îÁî®
# ==========================================
vector -> apps.rag {
  style.stroke: "#512da8"
}

lake -> apps.train {
  style.stroke: "#512da8"
}

lake -> apps.analytics {
  style.stroke: "#512da8"
}

# ==========================================
# Âõæ‰æã
# ==========================================
legend: "Legend" {
  near: bottom-center
  style: {
    fill: "#fafafa"
    stroke: "#9e9e9e"
    border-radius: 4
  }
  
  items: {
    shape: text
    style.font-size: 11
    label: "‚îÄ‚îÄ Real-time flow    - - Batch flow"
  }
}
