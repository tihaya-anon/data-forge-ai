# 数据采集架构
# 展示从多种数据源到 Kafka 的数据采集流程

grid-rows: 3

title: {
  label: 数据采集架构
  near: top-center
  shape: text
  style: {
    font-size: 24
    bold: true
    font-color: "#37474f"
  }
}

# 数据源层
sources: "数据源" {
  style: {
    fill: "#f5f5f5"
    stroke: "#78909c"
    border-radius: 8
  }

  grid-columns: 4
  grid-gap: 10

  mysql: MySQL {
    shape: cylinder
    style.fill: "#e8eaf6"
  }

  mongodb: MongoDB {
    shape: cylinder
    style.fill: "#e8eaf6"
  }

  files: "文件" {
    shape: document
    style.fill: "#e8eaf6"
  }

  apis: APIs {
    shape: cloud
    style.fill: "#e8eaf6"
  }
}

# 数据采集连接器
connectors: "数据连接器" {
  style: {
    fill: "#f5f5f5"
    stroke: "#78909c"
    border-radius: 8
  }

  grid-columns: 4
  grid-gap: 10

  debezium: "Debezium\nCDC" {
    style: {
      fill: "#c5cae9"
      border-radius: 6
    }
  }

  mongo_conn: "MongoDB\n连接器" {
    style: {
      fill: "#c5cae9"
      border-radius: 6
    }
  }

  file_source: "文件\n数据源" {
    style: {
      fill: "#c5cae9"
      border-radius: 6
    }
  }

  http_source: "HTTP\n数据源" {
    style: {
      fill: "#c5cae9"
      border-radius: 6
    }
  }
}

# Kafka 消息队列
kafka: "Apache Kafka" {
  style: {
    fill: "#f5f5f5"
    stroke: "#78909c"
    border-radius: 8
  }
  grid-columns: 2
  grid-gap: 10

  queue: "Kafka" {
    shape: queue
    style: {
      fill: "#9fa8da"
      stroke: "#7986cb"
      bold: true
      font-size: 16
      font-color: "#fff"
    }
  }

  topics: {
    shape: text
    style: {
      font-size: 12
      font-color: "#616161"
    }
    label: "• raw-documents\n• cdc-events\n• file-events"
  }
}

# 连接关系
sources.mysql -> connectors.debezium {
  style.stroke: "#78909c"
}

sources.mongodb -> connectors.mongo_conn {
  style.stroke: "#78909c"
}

sources.files -> connectors.file_source {
  style.stroke: "#78909c"
}

sources.apis -> connectors.http_source {
  style.stroke: "#78909c"
}

connectors.debezium -> kafka.queue {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

connectors.mongo_conn -> kafka.queue {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

connectors.file_source -> kafka.queue {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}

connectors.http_source -> kafka.queue {
  style: {
    stroke: "#78909c"
    stroke-width: 2
  }
}
